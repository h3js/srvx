---
icon: game-icons:soap-experiment
---

# Experimental Support

> See what the team is working on to improve srvx's core offering.

## Caution! Scientists at work!

Currently, **srvx** provides support for two experimental adapters: [Cloudflare][Cloudflare] and the web [Service Worker API][Service Worker].
The aim is to enable engineers to leverage **srvx** in any conceivable server environment,
even those that impose specific handling of requests/responses, such as Cloudflare's Edge Network or browser-based Service Workers.
**srvx**'s lean ergonomics and middleware are maintained to ensure the same experience across adapters.

## Cloudflare

The Cloudflare brand has rapidly established a name that developers trust,
so it only serves to reason that their Worker runtime environment would be a desirable target for **srvx** users.
The framework provides its universal compat layer for any requests in the Worker Environment by utilizing Cloudflare's Fetch Handler API,
ensuring that Cloudflare-specific properties, environment variables, and execution context are all accommodated.
Care is taken to preserve access to critical capabilities, like `waitUntil()` for background tasks, and
runtime metadata is attached to identify the execution context. This enables any application making use of **srvx**
to be deployed as a Cloudflare Worker while maintaining the niceties of the web standard API.

Upcoming: Handling IP addresses

**Ex.** - Cloudflare Workers ([learn more](https://www.cloudflare.com/developer-platform/products/workers/)):

```js
import { serve } from "srvx/adapters/cloudflare";

export default serve({
  fetch(request) {
    return new Response(`<h1>Hello from Cloudflare!</h1>`, {
      headers: { "Content-Type": "text/html; charset=UTF-8" },
    });
  },
});
```

## Service Workers

Anytime a Browser application has need for a proxy server to act in the absence of network availability, Service Workers are turned to. Whether completing computationally intensive tasks,
intercepting network requests, creating offline experiences, sending push notifications, or running background sync APIs, these are the purview of the
Service Worker. Retaining this core functionality is of crucial importance as any dev reaching for a Service Worker solution will expect consistency.
To this end, **srvx** smartly detects if it's running in a Browser or Service Worker context and delivers the commensurate behavior for each environment.
The entire Service Worker lifecycle is supported and managed as **srvx** self-registers, activates, and unregisters automatically. Critical features,
such as `waitUntil` capability for background operations, "claim immediately" behavior, and per-update page reloads so that new clients can be claimed.
During self-registration scenarios, any heavier application logic should be lazy loaded when performance implications are a concern (but when aren't they...? :smirk:).

> [!NOTE]
> As a safety measure, 404 responses and requests for static assets (i.e. URLs with file extensions) are skipped to avoid breaking normal browser behaviors.

Upcoming: An option for 404 handling will be explored

**Ex.** - Service Workers ([learn more](https://stackblitz.com/github/h3js/srvx/tree/main/playground?file=app.mjs)):

```js
import { serve } from "../node_modules/srvx/dist/adapters/service-worker.mjs";

// Internally the service worker is implemented by passing it as an option to the `serve()` function alongside `fetch()`
serve({
  serviceWorker: { url: import.meta.url },
  fetch(_request) {
    return new Response(`<h1>ðŸ‘‹ Hello there!</h1>`, {
      headers: { "Content-Type": "text/html; charset=UTF-8" },
    });
  },
});
```

[Cloudflare]: https://www.cloudflare.com/
[Service Worker]: https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API
